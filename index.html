<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WebAR Anatomy</title>

  <!-- A-Frame & AR.js -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/ar.js/aframe/build/aframe-ar.min.js"></script>
  <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh;">
  <button id="startAR" style="padding: 15px 30px; font-size: 16px; cursor: pointer;">
    Start AR Experience
  </button>

  <div id="arContainer" style="display: none; width: 100%; height: 100%;">
    <a-scene embedded arjs="sourceType: webcam;" organ-animations>
      <!-- Assets -->
      <a-assets>
        <a-asset-item id="h_anatomy" src="human_anatomy.glb"></a-asset-item>
        <a-asset-item id="h_skin" src="anatomy_of_the_skin.glb"></a-asset-item>
        <a-asset-item id="h_cell" src="animal_cell.glb"></a-asset-item>
        <a-asset-item id="heartModel" src="heart.glb"></a-asset-item>
        <a-asset-item id="brainModel" src="brain.glb"></a-asset-item>
        <a-asset-item id="LungModel" src="lungs.glb"></a-asset-item>
        <a-asset-item id="liverModel" src="liver.glb"></a-asset-item>
        <a-asset-item id="KidneyModel" src="kidney.glb"></a-asset-item>
        <a-asset-item id="stomachModel" src="stomach.glb"></a-asset-item>
        <a-asset-item id="intestineModel" src="intestine.glb"></a-asset-item>
      </a-assets>

      <!-- Human Anatomy Model -->
      <a-entity id="anatomy"  
        visible="true"
        gltf-model="#h_anatomy"
        position="1 5.5 -1"
        scale="145 145 145"
        animation-mixer>
        <!-- Heart organ -->
        <a-entity id="heart-group" class="organ" position="0 0.4 -2">
          <a-entity id="heart" gltf-model="#heartModel" scale="5 5 5" animation-mixer></a-entity>
          <a-entity id="heart-label" text="value: Heart; align: center; color: red" position="0.1 0 0"></a-entity>
          <a-entity 
            line="start: 0 0.4 -2; end: 0.4 0.4 -2; color: red"
            position="0 0 0">
          </a-entity>
        </a-entity>

        <a-entity id="brain-group" class="organ" position="0 0.6 -2">
          <a-entity id="brain" gltf-model="#brainModel" scale="1 1 1" animation-mixer></a-entity>
          <a-entity text="value: Brain; color: red; align: center;" position="0.1 0 0"></a-entity>
          <a-entity 
            line="start: 0 0.6 -2; end: 0.4 0.6 -2; color: red"
            position="0 0 0">
          </a-entity>
        </a-entity>

        <a-entity id="lung-group" class="organ" position="0 0.3 -2">
          <a-entity id="lungs" gltf-model="#LungModel" scale="1 1 1" animation-mixer></a-entity>
          <a-entity text="value:Lungs; color: red; align: center;" position="0 0.3 0"></a-entity>
          <a-entity 
            line="start: 0 0.3 -2; end: -0.6 0.3 -2; color: red"
            position="0 0 0">
          </a-entity>
        </a-entity>
  
        <a-entity id="intestine-group" class="organ" position="0 0 -2">
          <a-entity id="intestine" gltf-model="#intestineModel" scale="0.09 0.09 0.09" animation-mixer></a-entity>
          <a-entity text="value:Intestine; color: red; align: center;" position="0 0.09 0"></a-entity>
          <a-entity 
            line="start: 0 0 -2; end: -0.4 0 -2; color: red"
            position="0 0 0">
          </a-entity>
        </a-entity>
  
        <a-entity id="liver-group" class="organ" position="0 0.1 -2">
          <a-entity id="liver" gltf-model="#liverModel" scale="1 1 1" animation-mixer></a-entity>
          <a-entity text="value: Liver; color: red; align: center;" position="0 0.1 0"></a-entity>
          <a-entity 
            line="start: 0 0.1 -2; end: -0.6 0.1 -2; color: red"
            position="0 0 0">
          </a-entity>
        </a-entity>
  
        <a-entity id="kidney-group" class="organ" position="0 0.09 -2">
          <a-entity id="kidney" gltf-model="#KidneyModel" scale="6 6 6" animation-mixer></a-entity>
          <a-entity text="value:Kidneys; color: red; align: center;" position="0 0.1 0"></a-entity>
          <a-entity 
            line="start: 0 0.09 -2; end: 0.6 0.09 -2; color: red"
            position="0 0 0">
          </a-entity>
        </a-entity>
  
        <a-entity id="stomach-group" class="organ" position="0 0.2 -2">
          <a-entity id="stomach" gltf-model="#stomachModel" scale="0.09 0.09 0.09" animation-mixer></a-entity>
          <a-entity text="value: Stomach; color: red; align: center;" position="0 0 0"></a-entity>
          <a-entity 
            line="start: 0 0.2 -2; end: 0.4 0.2 -2; color: red"
            position="0 0 0">
          </a-entity>
        </a-entity>

      </a-entity>

      <!-- Skin Layers Model -->
      <a-entity id="skin" 
        position="1 0 -100" 
        scale="1 1 1"
        visible="false"
        gltf-model="#h_skin"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear">
      </a-entity>

      <!-- Animal Cell Model -->
      <a-entity id="cell" 
        position="25 5 -150" 
        scale="1 1 1"
        visible="false"
        gltf-model="#h_cell"
        animation-mixer>
      </a-entity>

      
      <!-- Quiz Button -->
      <a-entity id="quizButton"
                geometry="primitive: plane; height: 0.4; width: 1.5"
                material="color: #28a745; opacity: 0.9"
                position="0 1.5 -3"
                text="value: Take the Quiz; align: center; color: white; width: 4"
                visible="false"
                class="clickable"
                onclick="showQuiz()">
      </a-entity>

      <!-- Camera with raycaster & cursor -->
      <a-camera id="mainCamera" position="1 5 5" rotation="-30 -45 0" look-controls>
        <a-cursor></a-cursor>
      </a-camera>
    </a-scene>
    <!-- Quiz UI -->
    <div id="quiz-container" style="display: none; position: absolute; top: 10%; left: 5%; background: rgba(0,0,0,0.8); color: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; z-index: 1000;">
      <div style="text-align: right;">
        <button onclick="closeQuiz()" style="font-size: 18px; background: none; color: white; border: none; cursor: pointer;">&times;</button>
      </div>
      <h3>Cell Quiz</h3>
      <p id="quiz-question"></p>
      <div id="quiz-options"></div>
      <button onclick="nextQuestion()">Next</button>
    </div>
  </div>

  <script>
     AFRAME.registerComponent("organ-animations", {
        init: function () {
          setTimeout(() => {
            const organs = [
              { id: "heart-group", to: "0.5 0.4 -2" },
              { id: "brain-group", to: "0.5 0.6 -2" },
              { id: "lung-group", to: "-0.5 0.3 -2" },
              { id: "intestine-group", to: "-0.4 0 -2" },
              { id: "liver-group", to: "-0.6 0.1 -2" },
              { id: "kidney-group", to: "0.7 0.09 -2" },
              { id: "stomach-group", to: "0.5 0.2 -2" }
            ];

            organs.forEach((organ, index) => {
              const el = document.querySelector("#" + organ.id);
              el.setAttribute("animation__move", {
                property: "position",
                from: "0 0 0",
                to: organ.to,
                dur: 3000 + index * 200, // stagger the timing
                easing: "easeOutQuad"
              });
            });
          }, 2000); // Wait 2 seconds after loading body
        }
      });
      document.addEventListener("DOMContentLoaded", () => {
      const bodyModel = document.getElementById("anatomy");
      const organs = document.querySelectorAll(".organ");
  
      // Narration for each organ
      const organNarration = {
        heart: "This is the heart. It pumps blood to all parts of the body.",
        brain: "This is the brain. It controls thoughts, memory, and actions.",
        lungs: "These are the lungs. They help in breathing.",
        liver: "This is the liver. It helps filter blood and supports digestion.",
        kidney: "These are the kidneys. They filter waste from the blood.",
        intestine: "This is the intestine. It absorbs nutrients from digested food.",
        stomach: "This is the stomach. It breaks down food with acids."
      };
  
      organs.forEach((organ) => {
        organ.addEventListener("click", () => {
          // Hide body and other organs
          bodyModel.setAttribute("visible", false);
          organs.forEach((o) => {
            if (o !== organ) o.setAttribute("visible", false);
          });
  
          // Center the clicked organ
          organ.setAttribute("position", "0 0 -1");
  
          // Speak organ description
          const speech = new SpeechSynthesisUtterance(organNarration[organ.id]);
          speech.lang = 'en-US';
          window.speechSynthesis.speak(speech);
  
          // Reset after narration ends (optional)
          speech.onend = () => {
            bodyModel.setAttribute("visible", true);
            organs.forEach((o) => {
              o.setAttribute("visible", true);
              // Reset position if needed (custom per organ)
              if (o.id === "heart") o.setAttribute("position", "0.5 0.4 -2");
              if (o.id === "brain") o.setAttribute("position", "0.5 0.6 -2");
              if (o.id === "lungs") o.setAttribute("position", "-0.5 0.3 -2");
              if (o.id === "intestine") o.setAttribute("position", "-0.5 0 -2");
              if (o.id === "liver") o.setAttribute("position", "0.5 0.1 -2");
              if (o.id === "kidney") o.setAttribute("position", "-0.5 0.09 -2");
              if (o.id === "stomach") o.setAttribute("position", "0.5 0.2 -2");
            });
          };
        });
      });
    });

        
      function introSpeak(text, callback) {
      let utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "en-US";
      utterance.rate = 1;
      utterance.onend = callback;
      speechSynthesis.speak(utterance);
    }
    document.getElementById('startAR').addEventListener('click', async function () {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        if (stream) {
          document.getElementById('startAR').style.display = 'none';
          document.getElementById('arContainer').style.display = 'block';
          const h1 = document.querySelector("#anatomy");
          const h2 = document.querySelector("#skin");
          const h3 = document.querySelector("#cell");
          const camera = document.querySelector("#mainCamera");

          introSpeak("Welcome to the amazing journey inside the human body!", () => {
                // Show quiz button after skin
                  h1.setAttribute("visible", "true");
                  setTimeout(() => {
                    camera.setAttribute("animation", {
                      property: "position",
                      to: "1 5 5",
                      // dur: 5000,
                      easing: "easeInOutQuad"
                    });
                      
                      h1.setAttribute("visible", "false");
                      h2.setAttribute("visible", "true");
      
                      setTimeout(() => {
                        h2.setAttribute("visible", "false");
                        h3.setAttribute("visible", "true");
      
                        // Show quiz button after skin
                        setTimeout(() => {
                          document.querySelector("#quizButton").setAttribute("visible", "true");
                        }, 3000);
                      }, 5000); 
                  }, 10000);
          });
        }
      } catch (err) {
        alert("Camera permission denied. Please allow access to use AR.");
      }
    });

    const quizData = [
      { question: "Which part is male reproductive?", options: ["Pistil", "Sepal", "Stamen"], answer: "Stamen" },
      { question: "Which part is female reproductive?", options: ["Filament", "Stamen", "Pistil"], answer: "Pistil" },
      { question: "Which part attracts the pollen grains?", options: ["Stamen", "Anther", "Petal"], answer: "Petal" },
      { question: "Which part protects the buds?", options: ["Sepal", "Petal", "Stamen"], answer: "Sepal" }
    ];

    let currentQuestion = 0;

    function showQuiz() {
      document.getElementById("quiz-container").style.display = "block";
      loadQuestion();
    }

    function loadQuestion() {
      const q = quizData[currentQuestion];
      document.getElementById("quiz-question").innerText = q.question;

      let optionsHTML = "";
      q.options.forEach(opt => {
        optionsHTML += `<button onclick="checkAnswer('${opt}')" style="margin: 5px;">${opt}</button>`;
      });
      document.getElementById("quiz-options").innerHTML = optionsHTML;
    }

    function checkAnswer(selected) {
      const correct = quizData[currentQuestion].answer;
      if (selected === correct) {
        alert("‚úÖ Correct!");
      } else {
        alert("‚ùå Oops! The correct answer is: " + correct);
      }
    }

    function nextQuestion() {
      currentQuestion++;
      if (currentQuestion < quizData.length) {
        loadQuestion();
      } else {
        alert("üéâ Quiz Completed!");
        document.getElementById("quiz-container").style.display = "none";
        currentQuestion = 0;
      }
    }

    function closeQuiz() {
      document.getElementById("quiz-container").style.display = "none";
    }
  </script>
</body>
</html>
